(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2891:function(e,r,t){Promise.resolve().then(t.bind(t,5003))},5003:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return i}});var n=t(7437),a=t(2265),o=t(4033),s=t(6691),d=t.n(s),c=t(4519),l=t(4399);function i(){let[e,r]=(0,a.useState)(!1),t=(0,o.useRouter)(),{startRecording:s,stopRecording:i,sendDataToServer:u,loading:p}=(0,l.Z)(),{handleAddProduct:h,order:f,handleUpdateProduct:m,handleSetTakeout:g}=(0,c.Z)();return(0,n.jsxs)("div",{className:" flex justify-center items-center",children:[(0,n.jsx)("div",{className:" relative top-16 left-6",children:(0,n.jsx)(d(),{src:"/character.png",alt:"",width:500,height:1e3})}),(0,n.jsxs)("div",{className:" flex flex-col items-center relative mt-24",children:[(0,n.jsxs)("div",{className:" ml-10 mb-10",children:[(0,n.jsx)("div",{className:"text-h1 font-bold whitespace-nowrap ",children:"어디에서 드시나요?"}),(0,n.jsx)("div",{className:" flex ml-4",children:(0,n.jsx)("div",{className:" text-h3 font-medium",children:(0,n.jsx)("div",{children:"안녕하세요, 쉽고 빠른 음성 주문을 경험해보세요!"})})})]}),(0,n.jsxs)("div",{className:"flex bg-white p-4 rounded-lg text-[48px]",children:[(0,n.jsxs)("div",{className:" bg-[#FEBB15] drop-shadow-[-5px_20px_4px_rgba(0,0,0,0.15)] m-4 w-[541px] h-[670px] flex flex-col  items-center rounded-[60px]",onClick:()=>{g(!0),t.push("/f1")},children:[(0,n.jsx)("div",{className:" mt-20",children:(0,n.jsx)(d(),{src:"/takeout.png",width:322,height:322,alt:""})}),(0,n.jsx)("div",{className:"  mt-20 font-bold text-h2",children:'"포장하기"'})]}),(0,n.jsxs)("div",{className:" bg-[#FEBB15] drop-shadow-[-5px_20px_4px_rgba(0,0,0,0.15)]  m-4 w-[541px] h-[670px] flex flex-col  items-center rounded-[60px]",onClick:()=>{g(!1),t.push("/f1")},children:[(0,n.jsx)("div",{className:" mt-20",children:(0,n.jsx)(d(),{src:"/eatIn.png",width:322,height:322,alt:""})}),(0,n.jsx)("div",{className:" mt-20 font-bold text-h2",children:'"매장에서"'})]})]}),(0,n.jsx)("div",{className:"flex bg-white p-4 rounded-lg"})]})]})}},4399:function(e,r,t){"use strict";var n=t(2265),a=t(2993),o=t(4519),s=t(8290);r.Z=()=>{let e=(0,a.T)(),r=(0,a.C)(e=>e.recording.loading),{handleAddProduct:t,order:d,handleUpdateProduct:c,handleResetOrder:l}=(0,o.Z)(),[i,u]=(0,n.useState)(!1),p=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),[m,g]=(0,n.useState)(null),x=(0,n.useRef)([]),b=(0,n.useRef)(null),y=async()=>new Promise(async(r,t)=>{e((0,s.K4)(!0)),speechSynthesis.cancel();try{let t=await navigator.mediaDevices.getUserMedia({audio:!0});h.current=t,p.current=new AudioContext;let n=p.current.createMediaStreamSource(t),a=p.current.createAnalyser();a.fftSize=1024,n.connect(a);let o=new Uint8Array(a.frequencyBinCount),d=0,c=setInterval(()=>{a.getByteTimeDomainData(o);let e=0;for(let r=0;r<o.length;r++){let t=(o[r]-128)/128;e+=t*t}let r=Math.sqrt(e/o.length);r>.02?d=0:d+=200,d>5e3&&(v(),clearInterval(c))},200);b.current=c;let l=new MediaRecorder(t);l.ondataavailable=e=>{e.data.size>0&&x.current.push(e.data)},l.onstop=()=>{let t=new Blob(x.current,{type:"audio/webm"});x.current=[],e((0,s.K4)(!1)),r(t)},l.start(),u(!0),f.current=l}catch(e){console.error("Error accessing the microphone:",e),t(e)}finally{}}),v=()=>{f.current&&(f.current.stop(),h.current&&h.current.getTracks().forEach(e=>e.stop()),u(!1),null!==b.current&&(clearInterval(b.current),b.current=null))},w=async r=>{e((0,s.K4)(!0));let t=new FormData;t.append("audio_file",r,"audio.webm");try{let e=await fetch("https://sr-kiosk-api-shs2783.koyeb.app/api/stt/menu",{method:"POST",headers:{accept:"application/json"},body:t});if(e.ok){let r=await e.json();return r}}catch(e){console.log(e)}finally{e((0,s.K4)(!1))}};return{recording:i,audioBlob:m,startRecording:y,stopRecording:v,sendDataToServer:w,loading:r}}},4519:function(e,r,t){"use strict";var n=t(2993),a=t(8392),o=t(8035);r.Z=()=>{let e=(0,n.T)(),r=(0,n.C)(e=>e.order),t=async r=>{if(r instanceof Blob){let t=e((e,r)=>r()).order;try{let n=await e((0,o.M)(r));n.payload.burger?e((0,a.d1)(1)):2===t.orderStage?e((0,a.d1)(5)):e((0,a.d1)(2))}catch(e){console.error("Error processing voice:",e);return}}else{let t=e((e,r)=>r()).order;if(t.products.some(e=>e.orderNumber===r.orderNumber))return;e((0,a.gK)(r)),e((0,a.d1)(1))}};return{order:r,handleAddProduct:t,handleUpdateProduct:(r,t)=>{console.log(r,t),e((0,a.nM)({orderNumber:r,changes:t}))},handleRemoveProduct:r=>e((0,a.kh)(r)),handleResetOrder:()=>e((0,a.H8)()),handleSetTakeout:r=>e((0,a.O_)(r)),handleSetCurrentOrderNumber:r=>e((0,a.g0)(r)),handleSetOrderStage:r=>e((0,a.d1)(r)),handleSetPayStage:r=>e((0,a.q8)(r)),handleSetTargetOrderNumber:r=>e((0,a.V8)(r))}}},2993:function(e,r,t){"use strict";t.d(r,{C:function(){return o},T:function(){return a}});var n=t(3198);let a=()=>(0,n.I0)(),o=n.v9},8392:function(e,r,t){"use strict";t.d(r,{H8:function(){return l},O_:function(){return u},V8:function(){return m},d1:function(){return h},g0:function(){return p},gK:function(){return d},kh:function(){return c},nM:function(){return i},q8:function(){return f}});var n=t(64),a=t(8035);let o={products:[],isTakeout:!1,ok:!1,orderStage:0,payStage:0,currentOrderNumber:0,targetOrderNumber:0,menuPrices:{burger:{bigMac:[5900,8300],BTD:[5800,8200],bulgogi:[4500,5900]},options:{pickle:300,tomato:300,cabbage:300,onion:300,patty:1e3,cheese:500}}},s=(0,n.oM)({name:"order",initialState:o,reducers:{addProduct:(e,r)=>{e.products.push(r.payload)},removeProduct:(e,r)=>{e.products=e.products.filter(e=>e.orderNumber!==r.payload)},updateProduct:(e,r)=>{let{orderNumber:t,changes:n}=r.payload;console.log(t,n);let a=e.products.find(e=>e.orderNumber==t);a&&Object.assign(a,n),console.log(a)},resetOrder:()=>({...o}),setTakeout:(e,r)=>{e.isTakeout=r.payload},setOrderStage:(e,r)=>{e.orderStage=r.payload},setPayStage:(e,r)=>{e.payStage=r.payload},setCurrentOrderNumber:(e,r)=>{e.currentOrderNumber=r.payload},setTargetOrderNumber:(e,r)=>{e.targetOrderNumber=r.payload}},extraReducers:e=>{e.addCase(a.M.fulfilled,(e,r)=>{console.log(r.payload),r.payload.burger&&e.products.push({...r.payload,quantity:+r.payload.quantity||1,orderNumber:e.products.length,ingredients:{피클:0,토마토:0,양상추:0,양파:0,패티:0,치즈:0}})}),e.addCase(a.M.rejected,(e,r)=>{})}}),{addProduct:d,removeProduct:c,resetOrder:l,updateProduct:i,setTakeout:u,setCurrentOrderNumber:p,setOrderStage:h,setPayStage:f,setTargetOrderNumber:m}=s.actions;r.ZP=s.reducer},8290:function(e,r,t){"use strict";t.d(r,{K4:function(){return d}});var n=t(64);let a=(0,n.oM)({name:"recording",initialState:{recording:!1,audioBlob:null,loading:!1},reducers:{setRecording:(e,r)=>{e.recording=r.payload},setAudioBlob:(e,r)=>{e.audioBlob=r.payload},setLoading:(e,r)=>{e.loading=r.payload}}}),{setRecording:o,setAudioBlob:s,setLoading:d}=a.actions;r.ZP=a.reducer},8035:function(e,r,t){"use strict";t.d(r,{M:function(){return a}});var n=t(64);let a=(0,n.hg)("order/processVoiceForOrder",async e=>{let r=new FormData;r.append("audio_file",e,"audio.webm");let t=await fetch("https://sr-kiosk-api-shs2783.koyeb.app/api/stt/menu",{method:"POST",headers:{accept:"application/json"},body:r}),n=await t.json();if(!t.ok)throw Error("Server responded with a non-200 status");return n.menu})}},function(e){e.O(0,[713,758,971,596,744],function(){return e(e.s=2891)}),_N_E=e.O()}]);